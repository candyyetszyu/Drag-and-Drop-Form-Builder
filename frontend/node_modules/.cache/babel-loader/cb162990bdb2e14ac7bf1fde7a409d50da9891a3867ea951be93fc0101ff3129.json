{"ast":null,"code":"import React,{useState,useRef}from'react';import{useDrop}from'react-dnd';import FieldRenderer from'../shared/FieldRenderer';import DraggableField from'./DraggableField';import{useFormSubmission}from'../../hooks/useFormSubmission';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FormCanvas=_ref=>{let{fields,isPreview,onFieldSelect,onFieldUpdate,onFieldDelete,onDrop,onReorder,formId}=_ref;const[formData,setFormData]=useState({});const{submitForm,submitted,loading,error}=useFormSubmission();const canvasRef=useRef(null);// Set up drop target for the form canvas\nconst[{isOver,canDrop},drop]=useDrop({accept:'FIELD_TYPE',drop:(item,monitor)=>{const canvasRect=canvasRef.current.getBoundingClientRect();const dropY=monitor.getClientOffset().y-canvasRect.top;// Calculate insertion index based on mouse position\nlet insertIndex=fields.length;// Default to end\nconst fieldElements=canvasRef.current.querySelectorAll('.field-container');for(let i=0;i<fieldElements.length;i++){const rect=fieldElements[i].getBoundingClientRect();const fieldMiddle=rect.top+rect.height/2;if(dropY<fieldMiddle){insertIndex=i;break;}}onDrop(item.type,insertIndex);},collect:monitor=>({isOver:!!monitor.isOver(),canDrop:!!monitor.canDrop()})});const handleFieldChange=(fieldId,value)=>{console.log(`Field ${fieldId} changed to:`,value);// Update local state\nsetFormData(prev=>({...prev,[fieldId]:value}));// Update parent state if needed\nif(onFieldUpdate){const fieldToUpdate=fields.find(f=>f.id===fieldId);if(fieldToUpdate){onFieldUpdate({...fieldToUpdate,value:value});}}};const handleSubmit=async e=>{e.preventDefault();console.log(\"Form submitted with data:\",formData);if(isPreview&&formId){try{await submitForm(formId,formData);}catch(err){console.error(\"Error submitting form:\",err);}}};// Add drop indicator style\nconst dropIndicatorStyle=isOver&&canDrop?{backgroundColor:'rgba(59, 130, 246, 0.1)',border:'2px dashed #3b82f6',borderRadius:'0.5rem'}:{};// Display submission confirmation\nif(submitted){return/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center padding-responsive\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"Form Submitted Successfully!\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Thank you for your submission.\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:()=>window.location.reload(),children:\"Submit Another Response\"})]})});}return/*#__PURE__*/_jsx(\"div\",{className:\"card\",ref:node=>{drop(node);canvasRef.current=node;},style:{...dropIndicatorStyle,minHeight:'200px',transition:'background-color 0.2s, border 0.2s'},children:fields.length===0?/*#__PURE__*/_jsx(\"div\",{className:\"text-center padding-responsive\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Drag fields here from the panel to build your form.\"})}):/*#__PURE__*/_jsxs(\"form\",{className:\"space-responsive\",onSubmit:handleSubmit,children:[fields.map((field,index)=>isPreview?/*#__PURE__*/_jsx(\"div\",{className:\"padding-responsive margin-responsive field-container\",children:/*#__PURE__*/_jsx(FieldRenderer,{field:field,isPreview:isPreview,onChange:value=>handleFieldChange(field.id,value)})},field.id):/*#__PURE__*/_jsx(DraggableField,{field:field,index:index,onSelect:onFieldSelect,onDelete:onFieldDelete,onMove:onReorder,children:/*#__PURE__*/_jsx(FieldRenderer,{field:field,isPreview:isPreview,onChange:value=>handleFieldChange(field.id,value)})},field.id)),isPreview&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-center padding-responsive\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-primary\",disabled:loading,children:loading?'Submitting...':'Submit Form'}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"form-error\",children:error})]})]})});};export default FormCanvas;","map":{"version":3,"names":["React","useState","useRef","useDrop","FieldRenderer","DraggableField","useFormSubmission","jsx","_jsx","jsxs","_jsxs","FormCanvas","_ref","fields","isPreview","onFieldSelect","onFieldUpdate","onFieldDelete","onDrop","onReorder","formId","formData","setFormData","submitForm","submitted","loading","error","canvasRef","isOver","canDrop","drop","accept","item","monitor","canvasRect","current","getBoundingClientRect","dropY","getClientOffset","y","top","insertIndex","length","fieldElements","querySelectorAll","i","rect","fieldMiddle","height","type","collect","handleFieldChange","fieldId","value","console","log","prev","fieldToUpdate","find","f","id","handleSubmit","e","preventDefault","err","dropIndicatorStyle","backgroundColor","border","borderRadius","className","children","onClick","window","location","reload","ref","node","style","minHeight","transition","onSubmit","map","field","index","onChange","onSelect","onDelete","onMove","disabled"],"sources":["/Users/judyyip/Downloads/Website/Marketing Campaign/frontend/src/components/builder/FormCanvas.js"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { useDrop } from 'react-dnd';\nimport FieldRenderer from '../shared/FieldRenderer';\nimport DraggableField from './DraggableField';\nimport { useFormSubmission } from '../../hooks/useFormSubmission';\n\nconst FormCanvas = ({ \n  fields, \n  isPreview, \n  onFieldSelect, \n  onFieldUpdate, \n  onFieldDelete,\n  onDrop,\n  onReorder,\n  formId \n}) => {\n  const [formData, setFormData] = useState({});\n  const { submitForm, submitted, loading, error } = useFormSubmission();\n  const canvasRef = useRef(null);\n\n  // Set up drop target for the form canvas\n  const [{ isOver, canDrop }, drop] = useDrop({\n    accept: 'FIELD_TYPE',\n    drop: (item, monitor) => {\n      const canvasRect = canvasRef.current.getBoundingClientRect();\n      const dropY = monitor.getClientOffset().y - canvasRect.top;\n      \n      // Calculate insertion index based on mouse position\n      let insertIndex = fields.length; // Default to end\n      \n      const fieldElements = canvasRef.current.querySelectorAll('.field-container');\n      for (let i = 0; i < fieldElements.length; i++) {\n        const rect = fieldElements[i].getBoundingClientRect();\n        const fieldMiddle = rect.top + rect.height / 2;\n        \n        if (dropY < fieldMiddle) {\n          insertIndex = i;\n          break;\n        }\n      }\n      \n      onDrop(item.type, insertIndex);\n    },\n    collect: (monitor) => ({\n      isOver: !!monitor.isOver(),\n      canDrop: !!monitor.canDrop(),\n    }),\n  });\n\n  const handleFieldChange = (fieldId, value) => {\n    console.log(`Field ${fieldId} changed to:`, value);\n    \n    // Update local state\n    setFormData(prev => ({\n      ...prev,\n      [fieldId]: value\n    }));\n    \n    // Update parent state if needed\n    if (onFieldUpdate) {\n      const fieldToUpdate = fields.find(f => f.id === fieldId);\n      if (fieldToUpdate) {\n        onFieldUpdate({\n          ...fieldToUpdate,\n          value: value\n        });\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    console.log(\"Form submitted with data:\", formData);\n    \n    if (isPreview && formId) {\n      try {\n        await submitForm(formId, formData);\n      } catch (err) {\n        console.error(\"Error submitting form:\", err);\n      }\n    }\n  };\n\n  // Add drop indicator style\n  const dropIndicatorStyle = isOver && canDrop ? {\n    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n    border: '2px dashed #3b82f6',\n    borderRadius: '0.5rem',\n  } : {};\n\n  // Display submission confirmation\n  if (submitted) {\n    return (\n      <div className=\"card\">\n        <div className=\"text-center padding-responsive\">\n          <h2>Form Submitted Successfully!</h2>\n          <p>Thank you for your submission.</p>\n          <button \n            type=\"button\"\n            className=\"btn btn-primary\"\n            onClick={() => window.location.reload()}\n          >\n            Submit Another Response\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      className=\"card\" \n      ref={(node) => {\n        drop(node);\n        canvasRef.current = node;\n      }}\n      style={{\n        ...dropIndicatorStyle,\n        minHeight: '200px',\n        transition: 'background-color 0.2s, border 0.2s',\n      }}\n    >\n      {fields.length === 0 ? (\n        <div className=\"text-center padding-responsive\">\n          <p>Drag fields here from the panel to build your form.</p>\n        </div>\n      ) : (\n        <form className=\"space-responsive\" onSubmit={handleSubmit}>\n          {fields.map((field, index) => (\n            isPreview ? (\n              <div\n                key={field.id}\n                className=\"padding-responsive margin-responsive field-container\"\n              >\n                <FieldRenderer\n                  field={field}\n                  isPreview={isPreview}\n                  onChange={(value) => handleFieldChange(field.id, value)}\n                />\n              </div>\n            ) : (\n              <DraggableField\n                key={field.id}\n                field={field}\n                index={index}\n                onSelect={onFieldSelect}\n                onDelete={onFieldDelete}\n                onMove={onReorder}\n              >\n                <FieldRenderer\n                  field={field}\n                  isPreview={isPreview}\n                  onChange={(value) => handleFieldChange(field.id, value)}\n                />\n              </DraggableField>\n            )\n          ))}\n          \n          {isPreview && (\n            <div className=\"text-center padding-responsive\">\n              <button \n                type=\"submit\" \n                className=\"btn btn-primary\"\n                disabled={loading}\n              >\n                {loading ? 'Submitting...' : 'Submit Form'}\n              </button>\n              {error && <div className=\"form-error\">{error}</div>}\n            </div>\n          )}\n        </form>\n      )}\n    </div>\n  );\n};\n\nexport default FormCanvas;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}