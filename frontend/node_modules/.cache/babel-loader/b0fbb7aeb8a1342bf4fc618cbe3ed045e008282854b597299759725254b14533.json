{"ast":null,"code":"var _jsxFileName = \"/Users/judyyip/Downloads/Website/Marketing Campaign/frontend/src/components/builder/FormCanvas.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useRef } from 'react';\nimport { useDrop } from 'react-dnd';\n// Update import path for FieldRenderer\nimport FieldRenderer from '../fields/FieldRenderer';\nimport DraggableField from './DraggableField';\nimport { useFormSubmission } from '../../hooks/useFormSubmission';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FormCanvas = ({\n  fields,\n  isPreview,\n  onFieldSelect,\n  onFieldUpdate,\n  onFieldDelete,\n  onDrop,\n  onReorder,\n  formId,\n  themeColors = {\n    primaryColor: '#3b82f6',\n    cardBackground: '#ffffff'\n  }\n}) => {\n  _s();\n  const [formData, setFormData] = useState({});\n  const {\n    submitForm,\n    submitted,\n    loading,\n    error\n  } = useFormSubmission();\n  const canvasRef = useRef(null);\n\n  // Add validation state\n  const [validationErrors, setValidationErrors] = useState({});\n\n  // Helper function to validate the form\n  const validateForm = (fields, data) => {\n    const errors = {};\n    fields.forEach(field => {\n      if (field.validation) {\n        // Required field validation\n        if (field.validation.required && !data[field.id]) {\n          errors[field.id] = \"This field is required\";\n          return;\n        }\n        if (data[field.id]) {\n          const value = data[field.id];\n\n          // Pattern validation\n          if (field.validation.pattern) {\n            let pattern;\n            switch (field.validation.pattern) {\n              case 'email':\n                pattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n                break;\n              case 'phone':\n                pattern = /^\\d{10}$/;\n                break;\n              case 'number':\n                pattern = /^\\d+$/;\n                break;\n              case 'custom':\n                if (field.validation.customRule) {\n                  try {\n                    pattern = new RegExp(field.validation.customRule);\n                  } catch (error) {\n                    console.error(\"Invalid regex pattern:\", field.validation.customRule);\n                  }\n                }\n                break;\n              default:\n                break;\n            }\n            if (pattern && !pattern.test(value)) {\n              errors[field.id] = field.validation.errorMessage || \"Invalid format\";\n            }\n          }\n        }\n      }\n    });\n    return errors;\n  };\n\n  // Set up drop target for the form canvas\n  const [{\n    isOver,\n    canDrop\n  }, drop] = useDrop({\n    accept: 'FIELD_TYPE',\n    drop: (item, monitor) => {\n      const canvasRect = canvasRef.current.getBoundingClientRect();\n      const dropY = monitor.getClientOffset().y - canvasRect.top;\n\n      // Calculate insertion index based on mouse position\n      let insertIndex = fields.length; // Default to end\n\n      const fieldElements = canvasRef.current.querySelectorAll('.field-container');\n      for (let i = 0; i < fieldElements.length; i++) {\n        const rect = fieldElements[i].getBoundingClientRect();\n        const fieldMiddle = rect.top + rect.height / 2;\n        if (dropY < fieldMiddle) {\n          insertIndex = i;\n          break;\n        }\n      }\n      onDrop(item.type, insertIndex);\n    },\n    collect: monitor => ({\n      isOver: !!monitor.isOver(),\n      canDrop: !!monitor.canDrop()\n    })\n  });\n  const handleFieldChange = (fieldId, value) => {\n    console.log(`Field ${fieldId} changed to:`, value);\n\n    // Update local state\n    setFormData(prev => ({\n      ...prev,\n      [fieldId]: value\n    }));\n\n    // Check if this field has conditions that affect other fields\n    if (isPreview) {\n      const changedField = fields.find(f => f.id === fieldId);\n      if (changedField && changedField.type === 'dropdown' && changedField.conditions) {\n        // Find conditions that match the selected value\n        const activeConditions = changedField.conditions.filter(c => c.optionValue === value && c.action && c.targetId);\n\n        // Apply the conditions\n        activeConditions.forEach(condition => {\n          const targetField = fields.find(f => f.id === condition.targetId);\n          if (!targetField) return;\n          if (condition.action === 'skip_to') {\n            // Scroll to the target field\n            const targetElement = document.getElementById(`field-${condition.targetId}`);\n            if (targetElement) {\n              targetElement.scrollIntoView({\n                behavior: 'smooth'\n              });\n            }\n          }\n\n          // Additional logic for show/hide could be implemented here\n          // This would require modifying the component state to track visibility\n        });\n      }\n    }\n\n    // Update parent state if needed\n    if (onFieldUpdate) {\n      const fieldToUpdate = fields.find(f => f.id === fieldId);\n      if (fieldToUpdate) {\n        onFieldUpdate({\n          ...fieldToUpdate,\n          value: value\n        });\n      }\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    console.log(\"Form submitted with data:\", formData);\n\n    // Check if validation is required\n    if (isPreview && formData.validationCode) {\n      // Show validation code prompt\n      const code = prompt(\"Enter validation code to submit this form:\");\n      if (code !== formData.validationCode) {\n        alert(\"Invalid validation code\");\n        return;\n      }\n    }\n\n    // Validate form before submission\n    const errors = validateForm(fields, formData);\n    if (Object.keys(errors).length > 0) {\n      // Show validation errors\n      console.error(\"Form validation failed:\", errors);\n      setValidationErrors(errors);\n      return;\n    }\n\n    // Continue with submission\n    if (isPreview && formId) {\n      try {\n        await submitForm(formId, formData);\n      } catch (err) {\n        console.error(\"Error submitting form:\", err);\n      }\n    }\n  };\n\n  // Add drop indicator style\n  const dropIndicatorStyle = isOver && canDrop ? {\n    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n    border: '2px dashed #3b82f6',\n    borderRadius: '0.5rem'\n  } : {};\n\n  // Display submission confirmation\n  if (submitted) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center padding-responsive\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Form Submitted Successfully!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 204,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Thank you for your submission.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 205,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"btn btn-primary\",\n          onClick: () => window.location.reload(),\n          children: \"Submit Another Response\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 206,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"card\",\n    ref: node => {\n      drop(node);\n      canvasRef.current = node;\n    },\n    style: {\n      ...dropIndicatorStyle,\n      minHeight: '200px',\n      transition: 'background-color 0.2s, border 0.2s',\n      backgroundColor: themeColors.cardBackground\n    },\n    children: fields.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center padding-responsive\",\n      children: /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Drag fields here from the panel to build your form.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 233,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"form\", {\n      className: \"space-responsive\",\n      onSubmit: handleSubmit,\n      children: [fields.map((field, index) => isPreview ? /*#__PURE__*/_jsxDEV(\"div\", {\n        id: `field-${field.id}`,\n        className: \"padding-responsive margin-responsive field-container\",\n        children: [/*#__PURE__*/_jsxDEV(FieldRenderer, {\n          field: field,\n          isPreview: isPreview,\n          onChange: value => handleFieldChange(field.id, value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 245,\n          columnNumber: 17\n        }, this), validationErrors[field.id] && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-red-500 text-sm mt-1\",\n          children: validationErrors[field.id]\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 19\n        }, this)]\n      }, field.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 15\n      }, this) : /*#__PURE__*/_jsxDEV(DraggableField, {\n        field: field,\n        index: index,\n        onSelect: onFieldSelect,\n        onDelete: onFieldDelete,\n        onMove: onReorder,\n        children: /*#__PURE__*/_jsxDEV(FieldRenderer, {\n          field: field,\n          isPreview: isPreview,\n          onChange: value => handleFieldChange(field.id, value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 17\n        }, this)\n      }, field.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 15\n      }, this)), isPreview && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center padding-responsive\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"submit\",\n          className: \"btn btn-primary\",\n          disabled: loading,\n          style: {\n            backgroundColor: themeColors.primaryColor\n          },\n          children: loading ? 'Submitting...' : 'Submit Form'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 15\n        }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"form-error\",\n          children: error\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 284,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 219,\n    columnNumber: 5\n  }, this);\n};\n_s(FormCanvas, \"D0yssUTTNHTvmsg+yY9PjpO6n8g=\", false, function () {\n  return [useFormSubmission, useDrop];\n});\n_c = FormCanvas;\nexport default FormCanvas;\nvar _c;\n$RefreshReg$(_c, \"FormCanvas\");","map":{"version":3,"names":["React","useState","useRef","useDrop","FieldRenderer","DraggableField","useFormSubmission","jsxDEV","_jsxDEV","FormCanvas","fields","isPreview","onFieldSelect","onFieldUpdate","onFieldDelete","onDrop","onReorder","formId","themeColors","primaryColor","cardBackground","_s","formData","setFormData","submitForm","submitted","loading","error","canvasRef","validationErrors","setValidationErrors","validateForm","data","errors","forEach","field","validation","required","id","value","pattern","customRule","RegExp","console","test","errorMessage","isOver","canDrop","drop","accept","item","monitor","canvasRect","current","getBoundingClientRect","dropY","getClientOffset","y","top","insertIndex","length","fieldElements","querySelectorAll","i","rect","fieldMiddle","height","type","collect","handleFieldChange","fieldId","log","prev","changedField","find","f","conditions","activeConditions","filter","c","optionValue","action","targetId","condition","targetField","targetElement","document","getElementById","scrollIntoView","behavior","fieldToUpdate","handleSubmit","e","preventDefault","validationCode","code","prompt","alert","Object","keys","err","dropIndicatorStyle","backgroundColor","border","borderRadius","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","window","location","reload","ref","node","style","minHeight","transition","onSubmit","map","index","onChange","onSelect","onDelete","onMove","disabled","_c","$RefreshReg$"],"sources":["/Users/judyyip/Downloads/Website/Marketing Campaign/frontend/src/components/builder/FormCanvas.js"],"sourcesContent":["import React, { useState, useRef } from 'react';\nimport { useDrop } from 'react-dnd';\n// Update import path for FieldRenderer\nimport FieldRenderer from '../fields/FieldRenderer';\nimport DraggableField from './DraggableField';\nimport { useFormSubmission } from '../../hooks/useFormSubmission';\n\nconst FormCanvas = ({ \n  fields, \n  isPreview, \n  onFieldSelect, \n  onFieldUpdate, \n  onFieldDelete,\n  onDrop,\n  onReorder,\n  formId,\n  themeColors = { \n    primaryColor: '#3b82f6', \n    cardBackground: '#ffffff'\n  }\n}) => {\n  const [formData, setFormData] = useState({});\n  const { submitForm, submitted, loading, error } = useFormSubmission();\n  const canvasRef = useRef(null);\n\n  // Add validation state\n  const [validationErrors, setValidationErrors] = useState({});\n\n  // Helper function to validate the form\n  const validateForm = (fields, data) => {\n    const errors = {};\n    \n    fields.forEach(field => {\n      if (field.validation) {\n        // Required field validation\n        if (field.validation.required && !data[field.id]) {\n          errors[field.id] = \"This field is required\";\n          return;\n        }\n        \n        if (data[field.id]) {\n          const value = data[field.id];\n          \n          // Pattern validation\n          if (field.validation.pattern) {\n            let pattern;\n            switch (field.validation.pattern) {\n              case 'email':\n                pattern = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n                break;\n              case 'phone':\n                pattern = /^\\d{10}$/;\n                break;\n              case 'number':\n                pattern = /^\\d+$/;\n                break;\n              case 'custom':\n                if (field.validation.customRule) {\n                  try {\n                    pattern = new RegExp(field.validation.customRule);\n                  } catch (error) {\n                    console.error(\"Invalid regex pattern:\", field.validation.customRule);\n                  }\n                }\n                break;\n              default:\n                break;\n            }\n            \n            if (pattern && !pattern.test(value)) {\n              errors[field.id] = field.validation.errorMessage || \"Invalid format\";\n            }\n          }\n        }\n      }\n    });\n    \n    return errors;\n  };\n\n  // Set up drop target for the form canvas\n  const [{ isOver, canDrop }, drop] = useDrop({\n    accept: 'FIELD_TYPE',\n    drop: (item, monitor) => {\n      const canvasRect = canvasRef.current.getBoundingClientRect();\n      const dropY = monitor.getClientOffset().y - canvasRect.top;\n      \n      // Calculate insertion index based on mouse position\n      let insertIndex = fields.length; // Default to end\n      \n      const fieldElements = canvasRef.current.querySelectorAll('.field-container');\n      for (let i = 0; i < fieldElements.length; i++) {\n        const rect = fieldElements[i].getBoundingClientRect();\n        const fieldMiddle = rect.top + rect.height / 2;\n        \n        if (dropY < fieldMiddle) {\n          insertIndex = i;\n          break;\n        }\n      }\n      \n      onDrop(item.type, insertIndex);\n    },\n    collect: (monitor) => ({\n      isOver: !!monitor.isOver(),\n      canDrop: !!monitor.canDrop(),\n    }),\n  });\n\n  const handleFieldChange = (fieldId, value) => {\n    console.log(`Field ${fieldId} changed to:`, value);\n    \n    // Update local state\n    setFormData(prev => ({\n      ...prev,\n      [fieldId]: value\n    }));\n    \n    // Check if this field has conditions that affect other fields\n    if (isPreview) {\n      const changedField = fields.find(f => f.id === fieldId);\n      if (changedField && changedField.type === 'dropdown' && changedField.conditions) {\n        // Find conditions that match the selected value\n        const activeConditions = changedField.conditions.filter(c => \n          c.optionValue === value && c.action && c.targetId\n        );\n        \n        // Apply the conditions\n        activeConditions.forEach(condition => {\n          const targetField = fields.find(f => f.id === condition.targetId);\n          if (!targetField) return;\n          \n          if (condition.action === 'skip_to') {\n            // Scroll to the target field\n            const targetElement = document.getElementById(`field-${condition.targetId}`);\n            if (targetElement) {\n              targetElement.scrollIntoView({ behavior: 'smooth' });\n            }\n          }\n          \n          // Additional logic for show/hide could be implemented here\n          // This would require modifying the component state to track visibility\n        });\n      }\n    }\n    \n    // Update parent state if needed\n    if (onFieldUpdate) {\n      const fieldToUpdate = fields.find(f => f.id === fieldId);\n      if (fieldToUpdate) {\n        onFieldUpdate({\n          ...fieldToUpdate,\n          value: value\n        });\n      }\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    console.log(\"Form submitted with data:\", formData);\n    \n    // Check if validation is required\n    if (isPreview && formData.validationCode) {\n      // Show validation code prompt\n      const code = prompt(\"Enter validation code to submit this form:\");\n      if (code !== formData.validationCode) {\n        alert(\"Invalid validation code\");\n        return;\n      }\n    }\n    \n    // Validate form before submission\n    const errors = validateForm(fields, formData);\n    if (Object.keys(errors).length > 0) {\n      // Show validation errors\n      console.error(\"Form validation failed:\", errors);\n      setValidationErrors(errors);\n      return;\n    }\n    \n    // Continue with submission\n    if (isPreview && formId) {\n      try {\n        await submitForm(formId, formData);\n      } catch (err) {\n        console.error(\"Error submitting form:\", err);\n      }\n    }\n  };\n\n  // Add drop indicator style\n  const dropIndicatorStyle = isOver && canDrop ? {\n    backgroundColor: 'rgba(59, 130, 246, 0.1)',\n    border: '2px dashed #3b82f6',\n    borderRadius: '0.5rem',\n  } : {};\n\n  // Display submission confirmation\n  if (submitted) {\n    return (\n      <div className=\"card\">\n        <div className=\"text-center padding-responsive\">\n          <h2>Form Submitted Successfully!</h2>\n          <p>Thank you for your submission.</p>\n          <button \n            type=\"button\"\n            className=\"btn btn-primary\"\n            onClick={() => window.location.reload()}\n          >\n            Submit Another Response\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      className=\"card\" \n      ref={(node) => {\n        drop(node);\n        canvasRef.current = node;\n      }}\n      style={{\n        ...dropIndicatorStyle,\n        minHeight: '200px',\n        transition: 'background-color 0.2s, border 0.2s',\n        backgroundColor: themeColors.cardBackground,\n      }}\n    >\n      {fields.length === 0 ? (\n        <div className=\"text-center padding-responsive\">\n          <p>Drag fields here from the panel to build your form.</p>\n        </div>\n      ) : (\n        <form className=\"space-responsive\" onSubmit={handleSubmit}>\n          {fields.map((field, index) => (\n            isPreview ? (\n              <div\n                key={field.id}\n                id={`field-${field.id}`}\n                className=\"padding-responsive margin-responsive field-container\"\n              >\n                <FieldRenderer\n                  field={field}\n                  isPreview={isPreview}\n                  onChange={(value) => handleFieldChange(field.id, value)}\n                />\n                {validationErrors[field.id] && (\n                  <div className=\"text-red-500 text-sm mt-1\">\n                    {validationErrors[field.id]}\n                  </div>\n                )}\n              </div>\n            ) : (\n              <DraggableField\n                key={field.id}\n                field={field}\n                index={index}\n                onSelect={onFieldSelect}\n                onDelete={onFieldDelete}\n                onMove={onReorder}\n              >\n                <FieldRenderer\n                  field={field}\n                  isPreview={isPreview}\n                  onChange={(value) => handleFieldChange(field.id, value)}\n                />\n              </DraggableField>\n            )\n          ))}\n          \n          {isPreview && (\n            <div className=\"text-center padding-responsive\">\n              <button \n                type=\"submit\" \n                className=\"btn btn-primary\"\n                disabled={loading}\n                style={{ backgroundColor: themeColors.primaryColor }}\n              >\n                {loading ? 'Submitting...' : 'Submit Form'}\n              </button>\n              {error && <div className=\"form-error\">{error}</div>}\n            </div>\n          )}\n        </form>\n      )}\n    </div>\n  );\n};\n\nexport default FormCanvas;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}